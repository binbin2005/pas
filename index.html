<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>undangan</title>
    <link rel="stylesheet" href="./style.css" />

    <!-- link normalize buat tidak berantakan-->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    />

    <!-- font google -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Eczar:wght@400..800&family=Yellowtail&display=swap"
      rel="stylesheet"
    />

    <!-- bootstrap icon-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
  </head>
  <body>
    <div class="cover" id="cover">
      <img src="./img/cover.jpg" alt="Foto Undangan" />
      <div class="text-content">
        <h1>Undangan</h1>
        <h2>
          Bayuh Oton, <br />Menek Kelih,<br />
          Lan <br />
          Metatah
        </h2>
        <h3>Luh Weni Oktarini</h3>
        <p>Jumat, 11 Juli 2025</p>
        <p>Kepada Bapak/Ibu/Saudara/i <br /><span id="nama-tamu">Tamu</span></p>
        <br />
        <div>
          <a href="#" class="button" onclick="bukaUndangan()">
            <i class="bi bi-envelope"> Buka Undangan</i></a
          >
        </div>
      </div>
    </div>

    <!-- isi -->
    <!-- <div class="scroll-hidden"> -->
    <div id="undangan" class="isi scroll-hidden" style="display: none">
      <section>
        <div class="flower-container scroll-hidden">
          <img src="./img/latar/bunga-tanpa.png" alt="Bunga Dekoratif" />
        </div>
        <h2>Om Swastyastu</h2>
        <p>
          Atas Asung Kertha Wara Nugraha Ida Sang Hyang Widhi Wasa/Tuhan Yang
          Maha Esa kami bermaksud mengundang Bapak/Ibu/Saudara/i pada Upacara
          Manusa Yadnya Bayuh Otonan, Menek Kelih, Lan Metatah (Potong Gigi)
          Putri kami.
        </p>
        <h3>Luh Weni Oktarini</h3>
        <p>Putri Dari Pasangan</p>

        <h4>Nengah Suwariana & Luh Warna Aryati</h4>
      </section>

      <section>
        <div class="doa scroll-hidden">
          <div class="quote-box">
            <div class="sanskrit">
              Devan bhavayatanena te deva bhavayantu vah parasparam bhavayantah
              sreyah param avapsyatha
            </div>
            <div class="source">(Bhagavad Gita 3:11)</div>
            <div class="translation">
              Dengan ini (Yadnya), kami berbakti kepada Hyang Widhi dan dengan
              ini pula Hyang Widhi memelihara dan mengasihi kamu. <br />
              Dengan saling memelihara satu sama lain, kamu akan mencapai
              kebaikan yang maha tinggi.
            </div>
          </div>
        </div>
      </section>

      <section class="informasi scroll-hidden">
        <h2>Informasi Acara</h2>
        <div class="card-resepsi">
          <div class="card-header">WAKTU ACARA</div>
          <div class="card-body">
            <div class="card-item">
              <i class="bi bi-clock icon"></i>
              <div class="text">13.00 - 15.30 WITA</div>
            </div>
            <div class="card-item">
              <i class="bi bi-calendar-event icon"></i>
              <div class="text">Jumat, 11 Juli 2025</div>
            </div>
          </div>
          <div class="card-footer">
            Di harapkan untuk datang tepat waktu <br />
            (Waktu dan tempat terbatas)
          </div>
        </div>
        <div class="maps-container scroll-hidden">
          <h3>Lokasi Acara</h3>
          <div class="maps-responsive">
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3944.140331549614!2d115.2251066736548!3d-8.678202291369809!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2dd240f08b2e1db9%3A0xa375af741962e2e1!2sPadukuhan%20PAKU%20WANA!5e0!3m2!1sid!2sid!4v1744944703544!5m2!1sid!2sid"
              width="600"
              height="450"
              style="border: 0"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
            ></iframe>
          </div>
        </div>

        <div class="btn-maps-wrapper">
          <a
            href="https://maps.app.goo.gl/oA2HCFgMgkCn8XK88"
            target="_blank"
            class="btn-maps"
          >
            <i class="bi bi-geo-alt-fill"></i> Lihat Lokasi di Google Maps
          </a>
        </div>
      </section>

      <section>
        <div class="daun scroll-hidden">
          <img src="./img/latar/daun-tnpa.png" alt="Daun dekoratif" />
        </div>
      </section>

      <section>
        <div class="penutup scroll-hidden">
          <p>
            Merupakan suatu kebahagiaan dan kehormatan bagi kami apabila Bapak/
            Ibu/ Saudara/i berkenan hadir untuk memberikan doa restu.
          </p>
          <p>Atas kehadiran dan doa restunya kami ucapkan terimakasih</p>
          <h2>Om Shanti Shanti Shanti Om</h2>
          <h4>
            Kami yang berbahagia <br />
            Kel. Nengah Suwariana <br />& <br />
            Luh Warna Aryati
          </h4>
        </div>
      </section>

      <section>
        <div class="amplop scroll-hidden">
          <h2>Amplop Digital</h2>
          <p>
            Doa Restu Anda merupakan karunia yang sangat berarti bagi kami.<br />
            Dan jika memberi adalah ungkapan tanda kasih Anda, Anda dapat
            memberi kado cashless melalui transfer.
          </p>
          <button class="open-button" onclick="openModal()">
            <i class="bi bi-envelope-paper"> Kirim Amplop </i>
          </button>

          <div id="amplopModal" class="modal">
            <div class="modal-content">
              <span class="close" onclick="closeModal()">&times;</span>
              <p>Silahkan melakukan transfer ke rekening berikut:</p>

              <div class="bank-box">
                <img src="./img/bank/bca2.jpg" class="bank-logo" alt="BCA" />
                <div class="norek">767 0849362</div>
                <div>a/n Luh Weni Oktarini</div>
                <button class="copy-button" onclick="copyText('7670849362')">
                  COPY NO REKENING
                </button>
              </div>

              <div class="bank-box">
                <img src="./img/bank/bri2.jpg" class="bank-logo" alt="BRI" />
                <div class="norek">0970 01009719508</div>
                <div>a/n Luh Weni Oktarini</div>
                <button
                  class="copy-button"
                  onclick="copyText('097001009719508')"
                >
                  COPY NO REKENING
                </button>
              </div>
            </div>
          </div>
          <div class="end">
            <h2>Matur Suksma</h2>
          </div>
        </div>
      </section>

      <footer class="footer-undangan">
        <p>Terima kasih atas doa dan kehadiran Anda</p>
        <p>
          <i class="bi bi-instagram"></i>
          <a
            href="https://www.instagram.com/undangan.digital.05/"
            target="_blank"
            >@undangan.digital.05</a
          >
        </p>
      </footer>
    </div>
    <!-- </div> -->

    <!-- Audio Musik -->
    <audio id="audio" preload="auto" loop>
      <source src="./audio/audio-tanpa.mp3" type="audio/mpeg" />
    </audio>

    <!-- Tombol Musik -->
    <button class="music-btn" id="music-btn" onclick="toggleMusic()">
      <i id="music-icon" class="bi bi-pause-circle-fill"></i>
    </button>

    <script>
      // Ambil parameter dari URL
      const urlParams = new URLSearchParams(window.location.search);
      const namaTamu = urlParams.get("untuk");

      // Jika ada, ganti teksnya
      if (namaTamu) {
        document.getElementById("nama-tamu").textContent = decodeURIComponent(
          namaTamu.replace(/\+/g, " ")
        );
      }
    </script>

    <!-- css bootstrep -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>

    <script src="https://cdn.jsdelivr.net/npm/bs5-lightbox@1.8.3/dist/index.bundle.min.js"></script>

    <!-- scroll -->
    <script>
      /**
 * Script Undangan Digital yang Kompatibel dengan Semua Browser
 * Termasuk browser bawaan OPPO yang memiliki keterbatasan
 */

// Polyfill untuk Element.classList (untuk browser lama)
if (!("classList" in document.documentElement)) {
  Object.defineProperty(HTMLElement.prototype, 'classList', {
    get: function() {
      var self = this;
      function update(fn) {
        return function(value) {
          var classes = self.className.split(/\s+/);
          var index = classes.indexOf(value);
          fn(classes, index, value);
          self.className = classes.join(" ");
        };
      }

      return {
        add: update(function(classes, index, value) {
          if (index === -1) {
            classes.push(value);
          }
        }),
        remove: update(function(classes, index) {
          if (index !== -1) {
            classes.splice(index, 1);
          }
        }),
        toggle: update(function(classes, index, value) {
          if (index === -1) {
            classes.push(value);
          } else {
            classes.splice(index, 1);
          }
        }),
        contains: function(value) {
          return self.className.split(/\s+/).indexOf(value) !== -1;
        }
      };
    }
  });
}

// Fungsi untuk scroll dengan smooth behavior untuk browser yang tidak mendukung
function smoothScrollTo(element) {
  if (!element) return;
  
  // Periksa apakah smooth scrolling didukung
  var supportsScrollBehavior = 'scrollBehavior' in document.documentElement.style;
  
  if (supportsScrollBehavior) {
    element.scrollIntoView({ behavior: "smooth" });
  } else {
    // Implementasi manual untuk smooth scrolling
    var startY = window.pageYOffset;
    var targetY = element.getBoundingClientRect().top + startY;
    var duration = 500; // ms
    var startTime = null;
    
    function scrollStep(timestamp) {
      if (!startTime) startTime = timestamp;
      var progress = timestamp - startTime;
      var percentage = Math.min(progress / duration, 1);
      
      // Fungsi easing untuk animasi lebih halus
      var easeInOutQuad = function(t) {
        return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
      };
      
      window.scrollTo(0, startY + (targetY - startY) * easeInOutQuad(percentage));
      
      if (progress < duration) {
        window.requestAnimationFrame(scrollStep);
      }
    }
    
    // Fallback untuk requestAnimationFrame jika tidak didukung
    var requestAnimFrame = window.requestAnimationFrame ||
      window.webkitRequestAnimationFrame ||
      window.mozRequestAnimationFrame ||
      function(callback) { window.setTimeout(callback, 1000/60); };
    
    requestAnimFrame(scrollStep);
  }
}

// Fungsi untuk mengecek dukungan Storage API
function storageAvailable(type) {
  try {
    var storage = window[type],
        x = '__storage_test__';
    storage.setItem(x, x);
    storage.removeItem(x);
    return true;
  }
  catch(e) {
    return false;
  }
}

// Fungsi untuk menyimpan data jika sessionStorage tidak tersedia
function setData(key, value) {
  if (storageAvailable('sessionStorage')) {
    sessionStorage.setItem(key, value);
  } else {
    // Fallback menggunakan cookies
    document.cookie = key + "=" + value + "; path=/";
  }
}

// Fungsi untuk mengambil data
function getData(key) {
  if (storageAvailable('sessionStorage')) {
    return sessionStorage.getItem(key);
  } else {
    // Fallback menggunakan cookies
    var name = key + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');
    for(var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return null;
  }
}

// Fungsi untuk menghapus data
function removeData(key) {
  if (storageAvailable('sessionStorage')) {
    sessionStorage.removeItem(key);
  } else {
    // Hapus cookie dengan mengatur expired date
    document.cookie = key + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
  }
}

// Fungsi utama untuk membuka undangan
function bukaUndangan() {
  // Bungkus dalam try-catch untuk menangani segala error
  try {
    var cover = document.getElementById("cover");
    var undangan = document.getElementById("undangan");
    
    if (!cover || !undangan) {
      console.log("Elemen cover atau undangan tidak ditemukan");
      return;
    }
    
    // Sembunyikan cover dengan multiple techniques
    if (cover.classList && typeof cover.classList.add === 'function') {
      cover.classList.add("hidden");
    }
    
    // Pastikan cover tersembunyi dengan style langsung
    cover.style.display = "none";
    cover.style.visibility = "hidden";
    cover.style.opacity = "0";
    
    // Tampilkan undangan dengan multiple techniques
    undangan.style.display = "block";
    undangan.style.visibility = "visible";
    undangan.style.opacity = "1";
    
    // Scroll ke elemen undangan dengan kompatibilitas
    smoothScrollTo(undangan);
    
    // Simpan status bahwa undangan telah dibuka
    setData("undanganDibuka", "true");
    
  } catch (error) {
    console.log("Terjadi kesalahan:", error);
    
    // Fallback sederhana jika terjadi error
    var coverFallback = document.getElementById("cover");
    var undanganFallback = document.getElementById("undangan");
    
    if (coverFallback) {
      coverFallback.style.display = "none";
    }
    if (undanganFallback) {
      undanganFallback.style.display = "block";
    }
  }
}

// Fungsi yang dijalankan saat halaman dimuat
function initUndangan() {
  try {
    // Periksa apakah undangan sudah dibuka sebelumnya
    if (getData("undanganDibuka") === "true") {
      var cover = document.getElementById("cover");
      var undangan = document.getElementById("undangan");
      
      if (cover) {
        // Gunakan berbagai metode untuk memastikan tersembunyi
        if (cover.classList && typeof cover.classList.add === 'function') {
          cover.classList.add("hidden");
        }
        cover.style.display = "none";
        cover.style.visibility = "hidden";
      }
      
      if (undangan) {
        undangan.style.display = "block";
        undangan.style.visibility = "visible";
      }
      
      // Hapus status bahwa undangan telah dibuka
      removeData("undanganDibuka");
    }
    
    // Tambahkan event listener untuk tombol buka undangan
    var tombolBuka = document.querySelectorAll("[data-buka-undangan], .tombol-buka, .buka-undangan");
    for (var i = 0; i < tombolBuka.length; i++) {
      if (tombolBuka[i].addEventListener) {
        tombolBuka[i].addEventListener("click", bukaUndangan);
      } else if (tombolBuka[i].attachEvent) {
        // Untuk IE < 9
        tombolBuka[i].attachEvent("onclick", bukaUndangan);
      } else {
        tombolBuka[i].onclick = bukaUndangan;
      }
    }
  } catch (error) {
    console.log("Error saat inisialisasi:", error);
  }
}

// Gunakan berbagai metode untuk menjalankan kode saat halaman dimuat
if (window.addEventListener) {
  window.addEventListener("load", initUndangan);
} else if (window.attachEvent) {
  window.attachEvent("onload", initUndangan);
} else {
  window.onload = initUndangan;
}
    </script>

    <!-- amplop -->
    <script>
      function openModal() {
        document.getElementById("amplopModal").style.display = "block";
      }

      function closeModal() {
        document.getElementById("amplopModal").style.display = "none";
      }

      function copyText(text) {
        navigator.clipboard.writeText(text).then(() => {
          alert("Nomor rekening berhasil disalin!");
        });
      }

      window.onclick = function (event) {
        const modal = document.getElementById("amplopModal");
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };
    </script>

    <!-- animasi scrol -->

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const observer = new IntersectionObserver(
          function (entries) {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("scroll-show");
                observer.unobserve(entry.target); // agar tidak diulang
              }
            });
          },
          {
            threshold: 0.1,
          }
        );

        const hiddenElements = document.querySelectorAll(".scroll-hidden");
        hiddenElements.forEach((el) => observer.observe(el));
      });
    </script>

    <!-- musik -->
    <script>
      const audio = document.getElementById("audio");
      const musicBtn = document.getElementById("music-btn");
      const musicIcon = document.getElementById("music-icon");

      function toggleMusic() {
        if (audio.paused) {
          audio.play();
          musicIcon.className = "bi bi-pause-circle-fill";
        } else {
          audio.pause();
          musicIcon.className = "bi bi-play-circle-fill";
        }
      }

      function bukaUndangan() {
        const cover = document.getElementById("cover");
        const undangan = document.getElementById("undangan");

        cover.classList.add("hidden");
        undangan.style.display = "block";
        undangan.scrollIntoView({ behavior: "smooth" });

        sessionStorage.setItem("undanganDibuka", "true");

        // Putar musik setelah interaksi user (klik tombol)
        audio
          .play()
          .then(() => {
            musicBtn.style.display = "block";
          })
          .catch((e) => {
            console.log("Autoplay diblokir. Klik ikon musik.");
            musicBtn.style.display = "block";
          });
      }

      // Sembunyikan cover
      cover.classList.add("hidden");

      window.onload = function () {
        if (sessionStorage.getItem("undanganDibuka")) {
          document.getElementById("cover").classList.add("hidden");
          document.getElementById("undangan").style.display = "block";
          musicBtn.style.display = "block";
          audio.play();
          sessionStorage.removeItem("undanganDibuka");
        }
      };
    </script>

  </body>
</html>
